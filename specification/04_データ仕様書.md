# データ仕様書：社員管理システム

## 1. ドキュメント情報

| 項目 | 内容 |
|------|------|
| ドキュメント名 | データ仕様書 |
| システム名 | 社員管理システム |
| バージョン | 1.0 |
| 作成日 | 2025-12-01 |
| 作成者 | [作成者名] |

---

## 2. 概要

本ドキュメントでは、社員管理システムのデータベース設計、データモデル、データ定義を記載します。

---

## 3. データベース設計

### 3.1 ER図
```
[Department] --< [Employee]
```

### 3.2 リレーション
- Department（1）: Employee（多）
- 1つの部署に複数の社員が所属可能
- 1人の社員は1つの部署に所属

---

## 4. テーブル定義

### 4.1 departments テーブル

#### テーブル概要
部署情報を管理するテーブルです。

#### テーブル定義
| カラム名 | データ型 | NULL | 主キー | ユニーク | 説明 |
|---------|---------|------|--------|---------|------|
| id | BIGINT | NO | PK | - | 部署ID（自動採番） |
| name | VARCHAR(100) | NO | - | YES | 部署名 |
| code | VARCHAR(20) | NO | - | YES | 部署コード |
| created_at | TIMESTAMP | NO | - | - | 作成日時 |
| updated_at | TIMESTAMP | NO | - | - | 更新日時 |

#### インデックス
| インデックス名 | カラム | 種類 |
|--------------|--------|------|
| idx_department_code | code | UNIQUE |

#### 制約
- name: UNIQUE制約
- code: UNIQUE制約

#### 初期データ
| id | name | code |
|----|------|------|
| 1 | 営業部 | SALES |
| 2 | 開発部 | DEV |
| 3 | 人事部 | HR |

---

### 4.2 employees テーブル

#### テーブル概要
社員情報を管理するテーブルです。

#### テーブル定義
| カラム名 | データ型 | NULL | 主キー | ユニーク | 説明 |
|---------|---------|------|--------|---------|------|
| id | BIGINT | NO | PK | - | 社員ID（自動採番） |
| employee_number | VARCHAR(20) | NO | - | YES | 社員番号 |
| name | VARCHAR(100) | NO | - | - | 社員名 |
| email | VARCHAR(255) | NO | - | YES | メールアドレス |
| department_id | BIGINT | NO | FK | - | 部署ID |
| join_date | DATE | NO | - | - | 入社日 |
| created_at | TIMESTAMP | NO | - | - | 作成日時 |
| updated_at | TIMESTAMP | NO | - | - | 更新日時 |
| deleted_at | TIMESTAMP | YES | - | - | 削除日時（論理削除用） |

#### インデックス
| インデックス名 | カラム | 種類 |
|--------------|--------|------|
| idx_employee_email | email | UNIQUE |
| idx_employee_number | employee_number | UNIQUE |
| idx_employee_department | department_id | INDEX |
| idx_employee_name | name | INDEX |

#### 外部キー制約
| 制約名 | 参照元テーブル | 参照先テーブル | カラム |
|--------|---------------|---------------|--------|
| fk_employee_department | employees | departments | department_id |

#### 制約
- employee_number: UNIQUE制約
- email: UNIQUE制約
- department_id: 外部キー制約（departments.id）

#### ビジネスルール
- employee_numberは自動採番（形式: EMP001, EMP002, ...）
- emailは重複不可
- deleted_atがNULLでない場合は論理削除済み
- 論理削除された社員は取得・一覧表示の対象外

---

## 5. データモデル

### 5.1 Department（部署）

#### エンティティ定義
```java
@Entity
@Table(name = "departments")
public class Department {
    private Long id;              // 部署ID
    private String name;          // 部署名
    private String code;          // 部署コード
    private LocalDateTime createdAt;  // 作成日時
    private LocalDateTime updatedAt;  // 更新日時
}
```

#### 属性詳細
| 属性名 | 型 | 必須 | 説明 |
|--------|-----|------|------|
| id | Long | 必須 | 部署ID（自動採番） |
| name | String | 必須 | 部署名（1-100文字、ユニーク） |
| code | String | 必須 | 部署コード（1-20文字、ユニーク） |
| createdAt | LocalDateTime | 必須 | 作成日時（自動設定） |
| updatedAt | LocalDateTime | 必須 | 更新日時（自動更新） |

---

### 5.2 Employee（社員）

#### エンティティ定義
```java
@Entity
@Table(name = "employees")
public class Employee {
    private Long id;                      // 社員ID
    private String employeeNumber;        // 社員番号
    private String name;                  // 社員名
    private String email;                 // メールアドレス
    private Department department;        // 部署（ManyToOne）
    private LocalDate joinDate;           // 入社日
    private LocalDateTime createdAt;      // 作成日時
    private LocalDateTime updatedAt;      // 更新日時
    private LocalDateTime deletedAt;      // 削除日時（論理削除用）
}
```

#### 属性詳細
| 属性名 | 型 | 必須 | 説明 |
|--------|-----|------|------|
| id | Long | 必須 | 社員ID（自動採番） |
| employeeNumber | String | 必須 | 社員番号（1-20文字、ユニーク、自動採番） |
| name | String | 必須 | 社員名（1-100文字） |
| email | String | 必須 | メールアドレス（ユニーク） |
| department | Department | 必須 | 部署（外部キー） |
| joinDate | LocalDate | 必須 | 入社日 |
| createdAt | LocalDateTime | 必須 | 作成日時（自動設定） |
| updatedAt | LocalDateTime | 必須 | 更新日時（自動更新） |
| deletedAt | LocalDateTime | 任意 | 削除日時（論理削除用） |

---

## 6. データ定義

### 6.1 データ型マッピング

| Java型 | データベース型 | 説明 |
|--------|---------------|------|
| Long | BIGINT | 整数（ID等） |
| String | VARCHAR | 文字列 |
| LocalDate | DATE | 日付 |
| LocalDateTime | TIMESTAMP | 日時 |

### 6.2 文字列長制約

| 項目 | 最大長 | 説明 |
|------|--------|------|
| 部署名 | 100文字 | 部署名の最大長 |
| 部署コード | 20文字 | 部署コードの最大長 |
| 社員名 | 100文字 | 社員名の最大長 |
| 社員番号 | 20文字 | 社員番号の最大長 |
| メールアドレス | 255文字 | メールアドレスの最大長 |

---

## 7. データ整合性

### 7.1 参照整合性
- employees.department_idはdepartments.idを参照
- 存在しない部署IDは設定不可
- 部署を削除する場合は、その部署に所属する社員が存在しないことを確認

### 7.2 一意性制約
- departments.name: ユニーク
- departments.code: ユニーク
- employees.employee_number: ユニーク
- employees.email: ユニーク

### 7.3 データ整合性ルール
- 社員番号は自動採番（手動設定不可）
- メールアドレスは重複不可
- 削除は論理削除のみ（物理削除は不可）
- 論理削除された社員は取得・一覧表示の対象外

---

## 8. データ操作

### 8.1 CRUD操作

#### Create（作成）
- 社員作成時は社員番号を自動採番
- 作成日時・更新日時を自動設定

#### Read（読み取り）
- 論理削除された社員は取得対象外
- ページネーション対応

#### Update（更新）
- 更新日時を自動更新
- 社員番号は更新不可

#### Delete（削除）
- 論理削除を実施（deleted_atを設定）
- 物理削除は実施しない

---

## 9. データ移行

### 9.1 初期データ投入
- schema.sql: テーブル作成
- data.sql: 初期データ投入（部署データ）

### 9.2 データ移行手順
1. schema.sqlを実行してテーブルを作成
2. data.sqlを実行して初期データを投入

---

## 10. パフォーマンス考慮事項

### 10.1 インデックス
- 検索で使用されるカラムにインデックスを設定
- ユニーク制約のカラムにインデックスを設定

### 10.2 クエリ最適化
- 論理削除のチェックをクエリに含める
- ページネーションを使用して大量データを分割

---

## 11. 変更履歴

| バージョン | 変更日 | 変更内容 | 変更者 |
|-----------|--------|---------|--------|
| 1.0 | 2025-12-01 | 初版作成 | [作成者名] |

