# 詳細設計書テンプレート

## 1. ドキュメント情報

| 項目 | 内容 |
|------|------|
| ドキュメント名 | [機能名] 詳細設計書 |
| バージョン | 1.0 |
| 作成日 | YYYY-MM-DD |
| 作成者 | [作成者名] |
| 承認者 | [承認者名] |
| 承認日 | YYYY-MM-DD |

---

## 2. 概要

### 2.1 目的
本ドキュメントの目的を記載します。

### 2.2 対象範囲
本設計書の対象となる機能・モジュールを記載します。

### 2.3 前提条件
- 使用技術: Java, Spring Boot
- データベース: [DB名]
- その他の前提条件

---

## 3. システム構成

### 3.1 アーキテクチャ
```
[Controller層]
    ↓
[Service層]
    ↓
[Repository層]
    ↓
[Database]
```

### 3.2 技術スタック
- フレームワーク: Spring Boot 3.x
- ビルドツール: Maven
- データベース: H2 Database（開発環境）
- テストフレームワーク: JUnit 5, Mockito

---

## 4. 機能設計

### 4.1 機能一覧
| No | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| 1 | [機能1] | [説明] | 高 |
| 2 | [機能2] | [説明] | 中 |

### 4.2 機能詳細

#### 4.2.1 [機能名1]

##### 概要
[機能の概要を記載]

##### 処理フロー
```
1. [処理1]
2. [処理2]
3. [処理3]
```

##### 入力
- リクエストパラメータ
  - `param1`: [型] - [説明]
  - `param2`: [型] - [説明]

##### 出力
- レスポンス
  - `result1`: [型] - [説明]
  - `result2`: [型] - [説明]

##### エラーハンドリング
| エラーコード | エラーメッセージ | 発生条件 |
|-------------|-----------------|---------|
| ERR001 | [メッセージ] | [条件] |
| ERR002 | [メッセージ] | [条件] |

---

## 5. データベース設計

### 5.1 ER図
```
[Entity1] --< [Entity2]
    |
    |--< [Entity3]
```

### 5.2 テーブル定義

#### 5.2.1 [テーブル名]
| カラム名 | データ型 | NULL | 主キー | 説明 |
|---------|---------|------|--------|------|
| id | BIGINT | NO | PK | ID |
| name | VARCHAR(100) | NO | | 名前 |
| created_at | TIMESTAMP | NO | | 作成日時 |
| updated_at | TIMESTAMP | NO | | 更新日時 |

#### 5.2.2 インデックス
| インデックス名 | カラム | 種類 |
|--------------|--------|------|
| idx_name | name | INDEX |

#### 5.2.3 外部キー制約
| 制約名 | 参照元テーブル | 参照先テーブル | カラム |
|--------|---------------|---------------|--------|
| fk_xxx | [テーブル1] | [テーブル2] | [カラム] |

---

## 6. API設計

### 6.1 REST APIエンドポイント一覧
| メソッド | パス | 説明 | 認証 |
|---------|------|------|------|
| GET | /api/v1/users | ユーザー一覧取得 | 要 |
| GET | /api/v1/users/{id} | ユーザー詳細取得 | 要 |
| POST | /api/v1/users | ユーザー作成 | 要 |
| PUT | /api/v1/users/{id} | ユーザー更新 | 要 |
| DELETE | /api/v1/users/{id} | ユーザー削除 | 要 |

### 6.2 API詳細

#### 6.2.1 GET /api/v1/users
##### 説明
ユーザー一覧を取得します。

##### リクエスト
- クエリパラメータ
  - `page`: Integer - ページ番号（デフォルト: 0）
  - `size`: Integer - 1ページあたりの件数（デフォルト: 20）

##### レスポンス
```json
{
  "content": [
    {
      "id": 1,
      "name": "山田太郎",
      "email": "yamada@example.com"
    }
  ],
  "totalElements": 100,
  "totalPages": 5,
  "currentPage": 0
}
```

##### ステータスコード
- 200 OK: 正常終了
- 400 Bad Request: リクエストパラメータエラー
- 401 Unauthorized: 認証エラー
- 500 Internal Server Error: サーバーエラー

#### 6.2.2 POST /api/v1/users
##### 説明
新しいユーザーを作成します。

##### リクエスト
```json
{
  "name": "山田太郎",
  "email": "yamada@example.com",
  "password": "password123"
}
```

##### レスポンス
```json
{
  "id": 1,
  "name": "山田太郎",
  "email": "yamada@example.com",
  "createdAt": "2025-12-01T00:00:00"
}
```

##### ステータスコード
- 201 Created: 作成成功
- 400 Bad Request: バリデーションエラー
- 409 Conflict: 重複エラー（メールアドレス重複など）
- 500 Internal Server Error: サーバーエラー

---

## 7. クラス設計

### 7.1 クラス一覧
| クラス名 | パッケージ | 説明 |
|---------|-----------|------|
| UserController | com.company.system.controller | ユーザーコントローラー |
| UserService | com.company.system.service | ユーザーサービス |
| UserRepository | com.company.system.repository | ユーザーリポジトリ |
| User | com.company.system.model | ユーザーエンティティ |
| UserDto | com.company.system.dto | ユーザーDTO |

### 7.2 クラス詳細

#### 7.2.1 UserController
##### 責務
- HTTPリクエストの受け取り
- リクエストパラメータのバリデーション
- レスポンスの返却

##### メソッド一覧
| メソッド名 | 戻り値 | 説明 |
|-----------|--------|------|
| getUsers | ResponseEntity<List<UserDto>> | ユーザー一覧取得 |
| getUser | ResponseEntity<UserDto> | ユーザー詳細取得 |
| createUser | ResponseEntity<UserDto> | ユーザー作成 |
| updateUser | ResponseEntity<UserDto> | ユーザー更新 |
| deleteUser | ResponseEntity<Void> | ユーザー削除 |

#### 7.2.2 UserService
##### 責務
- ビジネスロジックの実装
- トランザクション管理
- 他サービスとの連携

##### メソッド一覧
| メソッド名 | 戻り値 | 説明 |
|-----------|--------|------|
| findAll | List<UserDto> | 全ユーザー取得 |
| findById | UserDto | IDでユーザー取得 |
| create | UserDto | ユーザー作成 |
| update | UserDto | ユーザー更新 |
| delete | void | ユーザー削除 |

##### ビジネスルール
- メールアドレスは重複不可
- パスワードは8文字以上
- 削除時は論理削除を実施

#### 7.2.3 UserRepository
##### 責務
- データベースアクセス
- CRUD操作の実装

##### メソッド一覧
| メソッド名 | 戻り値 | 説明 |
|-----------|--------|------|
| findAll | List<User> | 全ユーザー取得 |
| findById | Optional<User> | IDでユーザー取得 |
| findByEmail | Optional<User> | メールアドレスでユーザー取得 |
| save | User | ユーザー保存 |
| delete | void | ユーザー削除 |

#### 7.2.4 User（Entity）
##### 属性
| 属性名 | 型 | 説明 |
|--------|-----|------|
| id | Long | ID |
| name | String | 名前 |
| email | String | メールアドレス |
| password | String | パスワード（ハッシュ化） |
| createdAt | LocalDateTime | 作成日時 |
| updatedAt | LocalDateTime | 更新日時 |
| deletedAt | LocalDateTime | 削除日時（論理削除用） |

#### 7.2.5 UserDto
##### 属性
| 属性名 | 型 | 説明 |
|--------|-----|------|
| id | Long | ID |
| name | String | 名前 |
| email | String | メールアドレス |
| createdAt | LocalDateTime | 作成日時 |

---

## 8. 例外設計

### 8.1 例外クラス一覧
| 例外クラス名 | 説明 | HTTPステータス |
|------------|------|---------------|
| ResourceNotFoundException | リソースが見つからない | 404 Not Found |
| ValidationException | バリデーションエラー | 400 Bad Request |
| DuplicateResourceException | 重複エラー | 409 Conflict |
| InternalServerException | サーバーエラー | 500 Internal Server Error |

### 8.2 例外処理フロー
```
[Controller]
    ↓ 例外発生
[ExceptionHandler]
    ↓
[エラーレスポンス返却]
```

---

## 9. セキュリティ設計

### 9.1 認証・認可
- 認証方式: [JWT / Session / その他]
- 認可: [ロールベース / その他]

### 9.2 データ保護
- パスワード: ハッシュ化（BCrypt）
- 個人情報: 暗号化
- SQLインジェクション対策: PreparedStatement使用

---

## 10. パフォーマンス設計

### 10.1 キャッシュ戦略
- キャッシュ対象: [データ名]
- キャッシュ方式: [Redis / インメモリ / その他]
- TTL: [時間]

### 10.2 データベース最適化
- インデックス設計
- クエリ最適化
- ページネーション実装

---

## 11. ログ設計

### 11.1 ログレベル
- ERROR: エラー発生時
- WARN: 警告発生時
- INFO: 重要な処理の開始・終了
- DEBUG: デバッグ情報

### 11.2 ログ出力箇所
- リクエスト受信時（INFO）
- エラー発生時（ERROR）
- ビジネスロジックの重要ポイント（INFO）

---

## 12. テスト設計

### 12.1 単体テスト
- 対象: 各クラスのメソッド
- カバレッジ目標: 80%以上

### 12.2 結合テスト
- 対象: サービス層とリポジトリ層の連携
- データベースを使用したテスト

### 12.3 システムテスト
- 対象: エンドツーエンドのテスト
- 実際のアプリケーションを起動してテスト

---

## 13. 実装順序

1. データベーステーブル作成
2. Entityクラス実装
3. Repositoryクラス実装
4. Serviceクラス実装
5. Controllerクラス実装
6. DTOクラス実装
7. 例外クラス実装
8. 単体テスト実装
9. 結合テスト実装
10. システムテスト実装

---

## 14. 変更履歴

| バージョン | 変更日 | 変更内容 | 変更者 |
|-----------|--------|---------|--------|
| 1.0 | YYYY-MM-DD | 初版作成 | [作成者名] |

---

## 15. 参考資料

- [参考資料1]
- [参考資料2]

