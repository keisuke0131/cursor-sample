---
description: "仕様書作成ルール: 機能仕様書、API仕様書、データ仕様書の書き方とベストプラクティス"
globs:
  - "specification/**/*.md"
alwaysApply: false
---

# 仕様書作成ルール

## 仕様書の目的
仕様書は「何を実装するか」を定義するドキュメントです。実装方法ではなく、機能の要件と動作を明確に記述します。

## 仕様書の構成

### 1. ドキュメント情報
仕様書の基本情報を記載します。

```markdown
## 1. ドキュメント情報

| 項目 | 内容 |
|------|------|
| ドキュメント名 | 機能仕様書 |
| システム名 | 社員管理システム |
| バージョン | 1.0 |
| 作成日 | 2025-12-01 |
| 作成者 | [作成者名] |
| 承認者 | [承認者名] |
```

### 2. 機能仕様の記載項目
各機能について、以下の項目を必ず記載します。

#### 2.1 機能概要
機能の目的と概要を簡潔に記載します。

```markdown
#### 3.1.1 機能概要
新しい社員をシステムに登録します。
```

#### 2.2 入力項目
リクエストパラメータや入力データを表形式で記載します。

```markdown
#### 3.1.2 入力項目
| 項目名 | データ型 | 必須 | 制約 | 説明 |
|--------|---------|------|------|------|
| name | String | 必須 | 1-100文字 | 社員名 |
| email | String | 必須 | メール形式 | メールアドレス |
| departmentId | Long | 必須 | 存在する部署ID | 部署ID |
```

**記載のポイント:**
- データ型は正確に記載（String, Long, LocalDate等）
- 必須/任意を明確に記載
- 制約条件を具体的に記載（文字数、形式、値の範囲等）
- 説明は簡潔に、わかりやすく

#### 2.3 出力項目
レスポンスデータを表形式で記載します。

```markdown
#### 3.1.3 出力項目
| 項目名 | データ型 | 説明 |
|--------|---------|------|
| id | Long | 社員ID |
| employeeNumber | String | 社員番号（自動採番） |
| name | String | 社員名 |
```

**記載のポイント:**
- レスポンスに含まれるすべての項目を記載
- 自動生成される項目はその旨を記載
- ネストされたオブジェクトは別表で記載

#### 2.4 処理フロー
処理の流れをステップ形式で記載します。

```markdown
#### 3.1.4 処理フロー
1. リクエストパラメータのバリデーション
2. メールアドレスの重複チェック
3. 部署の存在チェック
4. 社員番号の自動採番
5. 社員情報をデータベースに保存
6. 登録された社員情報を返却
```

**記載のポイント:**
- 処理の順序を明確に
- 各ステップを簡潔に記載
- 条件分岐がある場合は分岐を明記

#### 2.5 ビジネスルール
ビジネス上の制約やルールを記載します。

```markdown
#### 3.1.5 ビジネスルール
- メールアドレスは重複不可
- 社員番号は自動採番（形式: EMP001, EMP002, ...）
- 部署IDは存在する必要がある
```

**記載のポイント:**
- ビジネス上の制約を明確に
- 自動採番の形式を具体的に記載
- データの整合性に関するルールを記載

#### 2.6 エラー処理
エラーケースとエラーレスポンスを表形式で記載します。

```markdown
#### 3.1.6 エラー処理
| エラーコード | エラーメッセージ | HTTPステータス | 発生条件 |
|-------------|-----------------|---------------|---------|
| ERR001 | メールアドレスが重複しています | 409 Conflict | 既に登録されているメールアドレス |
| ERR002 | 部署が存在しません | 404 Not Found | 存在しない部署ID |
| ERR003 | バリデーションエラー | 400 Bad Request | リクエストパラメータが不正 |
```

**記載のポイント:**
- すべてのエラーケースを網羅
- エラーコードは一意に
- HTTPステータスコードを正確に記載
- 発生条件を具体的に記載

## API仕様書の書き方

### エンドポイント定義
各APIエンドポイントについて、以下を記載します。

```markdown
### 4.1 GET /api/v1/employees

#### 概要
社員一覧を取得します。

#### リクエスト
**パスパラメータ**
なし

**クエリパラメータ**
| パラメータ名 | 型 | 必須 | デフォルト値 | 説明 |
|------------|-----|------|------------|------|
| page | Integer | 任意 | 0 | ページ番号（0始まり） |
| size | Integer | 任意 | 20 | 1ページあたりの件数 |

**リクエスト例**
```
GET /api/v1/employees?page=0&size=20
```

#### レスポンス
**成功時（200 OK）**
```json
{
  "content": [...],
  "totalElements": 100,
  "totalPages": 5,
  "currentPage": 0
}
```

**エラー時**
| ステータスコード | エラーコード | 説明 |
|----------------|------------|------|
| 400 Bad Request | ERR003 | バリデーションエラー |
```

**記載のポイント:**
- HTTPメソッドとパスを明確に記載
- リクエストパラメータを表形式で記載
- レスポンスのJSON例を記載
- エラーケースを網羅的に記載

## データ仕様書の書き方

### テーブル定義
各テーブルについて、以下を記載します。

```markdown
### 4.1 employees テーブル

#### テーブル概要
社員情報を管理するテーブルです。

#### テーブル定義
| カラム名 | データ型 | NULL | 主キー | ユニーク | 説明 |
|---------|---------|------|--------|---------|------|
| id | BIGINT | NO | PK | - | 社員ID（自動採番） |
| employee_number | VARCHAR(20) | NO | - | YES | 社員番号 |
| name | VARCHAR(100) | NO | - | - | 社員名 |
| email | VARCHAR(255) | NO | - | YES | メールアドレス |

#### インデックス
| インデックス名 | カラム | 種類 |
|--------------|--------|------|
| idx_employee_email | email | UNIQUE |

#### 外部キー制約
| 制約名 | 参照元テーブル | 参照先テーブル | カラム |
|--------|---------------|---------------|--------|
| fk_employee_department | employees | departments | department_id |
```

**記載のポイント:**
- データ型を正確に記載
- NULL制約、主キー、ユニーク制約を明確に
- インデックスを記載
- 外部キー制約を記載

## 仕様書作成のベストプラクティス

### 1. 明確性
- 曖昧な表現を避ける
- 専門用語は定義を記載
- 数値や日付の形式を明確に

**悪い例:**
```markdown
- 社員名を入力する
- 適切なエラーメッセージを返す
```

**良い例:**
```markdown
- 社員名を入力する（1-100文字、必須）
- エラーメッセージ「メールアドレスが重複しています」を返す（HTTPステータス: 409 Conflict）
```

### 2. 完全性
- すべての入力項目を記載
- すべての出力項目を記載
- すべてのエラーケースを記載
- すべてのビジネスルールを記載

### 3. 一貫性
- 用語を統一（例: 「社員」と「ユーザー」を混在させない）
- 表形式のフォーマットを統一
- エラーコードの命名規則を統一

### 4. 検証可能性
- テスト可能な形で記載
- 期待結果を明確に記載
- 境界値を明確に記載

**良い例:**
```markdown
- 社員名: 1-100文字（1文字と100文字は有効、0文字と101文字は無効）
- ページ番号: 0以上（0は有効、-1は無効）
```

### 5. 保守性
- 変更履歴を記載
- バージョン管理を実施
- 関連ドキュメントへのリンクを記載

## 仕様書のテンプレート

新しい機能を追加する際は、以下のテンプレートを使用してください。

```markdown
### X.X 機能名（機能ID）

#### X.X.1 機能概要
[機能の目的と概要]

#### X.X.2 入力項目
| 項目名 | データ型 | 必須 | 制約 | 説明 |
|--------|---------|------|------|------|
| [項目名] | [型] | [必須/任意] | [制約] | [説明] |

#### X.X.3 出力項目
| 項目名 | データ型 | 説明 |
|--------|---------|------|
| [項目名] | [型] | [説明] |

#### X.X.4 処理フロー
1. [処理1]
2. [処理2]
3. [処理3]

#### X.X.5 ビジネスルール
- [ルール1]
- [ルール2]

#### X.X.6 エラー処理
| エラーコード | エラーメッセージ | HTTPステータス | 発生条件 |
|-------------|-----------------|---------------|---------|
| [コード] | [メッセージ] | [ステータス] | [条件] |
```

## 仕様書レビューの観点
1. **完全性**: 必要な情報がすべて記載されているか
2. **明確性**: 曖昧な表現がないか
3. **一貫性**: 用語やフォーマットが統一されているか
4. **検証可能性**: テスト可能な形で記載されているか
5. **実装可能性**: 実装可能な内容か

## 参考ドキュメント

- 既存の仕様書: `specification/`配下
  - `01_システム概要仕様書.md`: システム全体の概要
  - `02_機能仕様書.md`: 各機能の詳細仕様
  - `03_API仕様書.md`: REST APIの詳細仕様
  - `04_データ仕様書.md`: データベース設計とデータ定義

