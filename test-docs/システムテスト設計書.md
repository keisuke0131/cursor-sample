# システムテスト設計書：社員管理システム

## 1. ドキュメント情報

| 項目 | 内容 |
|------|------|
| ドキュメント名 | システムテスト設計書 |
| 対象システム | 社員管理システム |
| バージョン | 1.0 |
| 作成日 | 2025-12-01 |
| 作成者 | [作成者名] |
| 承認者 | [承認者名] |

---

## 2. 概要

### 2.1 目的
本ドキュメントでは、社員管理システムのシステムテストのテストシナリオ、テスト手順、期待結果を定義します。
システムテストでは、エンドツーエンドの動作を確認し、実際のユースケースに基づいたテストを実施します。

### 2.2 テスト対象
- システム全体の動作
- エンドツーエンドのシナリオ
- エラーハンドリング
- パフォーマンス（簡易確認）

### 2.3 テスト環境
- アプリケーションサーバー: Spring Boot（ポート: 8080）
- データベース: H2 Database（インメモリ）
- テストツール: Postman、curl、またはブラウザ

---

## 3. テスト方針

### 3.1 テストレベル
- エンドツーエンドのテスト
- 実際のユースケースに基づいたテスト
- エラーハンドリングの確認

### 3.2 テストデータ
- テスト実行前に初期データを投入
- 各テストシナリオは独立して実行可能
- テスト実行後はデータをクリーンアップ

---

## 4. テストシナリオ

### 4.1 シナリオ1: 社員作成から削除までの一連の流れ

#### シナリオ概要
新入社員の登録から退職までの一連の業務フローをテストします。

#### テスト目的
社員管理の基本的なCRUD操作が正しく動作することを確認する。

#### 前提条件
- アプリケーションが起動している
- 部署データが登録されている

#### テスト手順

##### ステップ1: 社員作成
1. 社員作成APIを呼び出す
   - メソッド: POST
   - URL: `http://localhost:8080/api/v1/employees`
   - リクエストボディ:
     ```json
     {
       "name": "システムテストユーザー",
       "email": "systemtest@example.com",
       "departmentId": 1,
       "joinDate": "2025-12-01"
     }
     ```

2. レスポンスを確認する
   - ステータスコード: 201 Created
   - Content-Type: application/json
   - レスポンスボディに社員情報が含まれている
   - 社員番号が自動採番されている（例: EMP001）
   - 作成日時が設定されている
   - id、employeeNumber、name、email、department、joinDate、createdAtが含まれている

3. レスポンスから社員IDを取得する

**期待結果**
- 社員が正常に作成される
- 社員番号が自動採番される
- レスポンスに必要な情報がすべて含まれている

---

##### ステップ2: 社員詳細取得
1. 作成した社員IDで社員取得APIを呼び出す
   - メソッド: GET
   - URL: `http://localhost:8080/api/v1/employees/{id}`

2. レスポンスを確認する
   - ステータスコード: 200 OK
   - Content-Type: application/json
   - 作成した社員情報が正しく返却される
   - 部署情報も含まれている（department.id、department.name、department.code）

**期待結果**
- 作成した社員が正しく取得できる
- 部署情報も正しく含まれている

---

##### ステップ3: 社員一覧取得
1. 社員一覧取得APIを呼び出す
   - メソッド: GET
   - URL: `http://localhost:8080/api/v1/employees?page=0&size=20`

2. レスポンスを確認する
   - ステータスコード: 200 OK
   - Content-Type: application/json
   - 作成した社員が一覧に含まれている
   - ページネーション情報が正しい（totalElements、totalPages、currentPage）

**期待結果**
- 社員一覧が正常に取得できる
- 作成した社員が一覧に含まれている
- ページネーションが正しく動作している

---

##### ステップ4: 社員更新
1. 社員更新APIを呼び出す
   - メソッド: PUT
   - URL: `http://localhost:8080/api/v1/employees/{id}`
   - リクエストボディ:
     ```json
     {
       "name": "更新されたユーザー名",
       "email": "updated@example.com",
       "departmentId": 2
     }
     ```

2. レスポンスを確認する
   - ステータスコード: 200 OK
   - Content-Type: application/json
   - 更新された社員情報が返却される
   - 更新された項目が正しく返却される

3. 更新後の社員情報を取得して確認する
   - メソッド: GET
   - URL: `http://localhost:8080/api/v1/employees/{id}`

**期待結果**
- 社員情報が正常に更新される
- 更新内容が正しく反映される
- 更新後の情報が正しく取得できる

---

##### ステップ5: 社員削除（論理削除）
1. 社員削除APIを呼び出す
   - メソッド: DELETE
   - URL: `http://localhost:8080/api/v1/employees/{id}`

2. レスポンスを確認する
   - ステータスコード: 204 No Content
   - レスポンスボディが空

3. 削除後の社員取得APIを呼び出す
   - メソッド: GET
   - URL: `http://localhost:8080/api/v1/employees/{id}`

4. レスポンスを確認する
   - ステータスコード: 404 Not Found
   - Content-Type: application/json
   - エラーレスポンスが返却される
   - errorCode: ERR004
   - message: "社員が見つかりません"
   - timestampが含まれている

5. 社員一覧取得APIを呼び出す
   - メソッド: GET
   - URL: `http://localhost:8080/api/v1/employees`

6. レスポンスを確認する
   - ステータスコード: 200 OK
   - Content-Type: application/json
   - 削除した社員が一覧に含まれていない

**期待結果**
- 社員が論理削除される
- 削除後は社員が取得できない
- 削除した社員は一覧に表示されない

---

#### テストデータ
- 社員名: システムテストユーザー
- メールアドレス: systemtest@example.com
- 部署ID: 1（営業部）
- 入社日: 2025-12-01
- 更新後の名前: 更新されたユーザー名
- 更新後のメールアドレス: updated@example.com
- 更新後の部署ID: 2（開発部）

---

### 4.2 シナリオ2: エラーハンドリングの確認

#### シナリオ概要
各種エラーケースが正しくハンドリングされることを確認します。

#### テスト目的
エラーハンドリングが正しく動作することを確認する。

#### 前提条件
- アプリケーションが起動している
- 部署データが登録されている

#### テスト手順

##### エラーケース1: 存在しないIDで社員取得
1. 存在しない社員IDで社員取得APIを呼び出す
   - メソッド: GET
   - URL: `http://localhost:8080/api/v1/employees/999`

2. レスポンスを確認する
   - ステータスコード: 404 Not Found
   - Content-Type: application/json
   - エラーレスポンスが返却される
   - errorCode: ERR004
   - message: "社員が見つかりません"
   - timestampが含まれている

**期待結果**
- 404エラーが返却される
- エラーレスポンスが正しい形式で返却される

---

##### エラーケース2: 無効なリクエストで社員作成
1. 無効なリクエストで社員作成APIを呼び出す
   - メソッド: POST
   - URL: `http://localhost:8080/api/v1/employees`
   - リクエストボディ:
     ```json
     {
       "name": "",
       "email": "invalid-email",
       "departmentId": null,
       "joinDate": null
     }
     ```

2. レスポンスを確認する
   - ステータスコード: 400 Bad Request
   - Content-Type: application/json
   - エラーレスポンスが返却される
   - errorCode: ERR003
   - messageにバリデーションエラーの詳細が含まれている
   - timestampが含まれている

**期待結果**
- 400エラーが返却される
- バリデーションエラーの詳細が返却される

---

##### エラーケース3: 重複するメールアドレスで社員作成
1. 最初の社員を作成する
   - メソッド: POST
   - URL: `http://localhost:8080/api/v1/employees`
   - リクエストボディ:
     ```json
     {
       "name": "山田太郎",
       "email": "yamada@example.com",
       "departmentId": 1,
       "joinDate": "2025-12-01"
     }
     ```

2. 同じメールアドレスで再度社員作成APIを呼び出す
   - メソッド: POST
   - URL: `http://localhost:8080/api/v1/employees`
   - リクエストボディ:
     ```json
     {
       "name": "佐藤花子",
       "email": "yamada@example.com",
       "departmentId": 1,
       "joinDate": "2025-12-01"
     }
     ```

3. レスポンスを確認する
   - ステータスコード: 409 Conflict
   - Content-Type: application/json
   - エラーレスポンスが返却される
   - errorCode: ERR001
   - message: "メールアドレスが重複しています"
   - timestampが含まれている

**期待結果**
- 409エラーが返却される
- 重複エラーのメッセージが返却される
- 最初の社員は正常に作成されている

---

##### エラーケース4: 存在しない部署IDで社員作成
1. 存在しない部署IDで社員作成APIを呼び出す
   - メソッド: POST
   - URL: `http://localhost:8080/api/v1/employees`
   - リクエストボディ:
     ```json
     {
       "name": "テストユーザー",
       "email": "test@example.com",
       "departmentId": 999,
       "joinDate": "2025-12-01"
     }
     ```

2. レスポンスを確認する
   - ステータスコード: 404 Not Found
   - Content-Type: application/json
   - エラーレスポンスが返却される
   - errorCode: ERR004
   - message: "部署が存在しません"
   - timestampが含まれている

**期待結果**
- 404エラーが返却される
- 部署不存在のエラーメッセージが返却される

---

#### テストデータ
- 存在しない社員ID: 999
- 重複メールアドレス: yamada@example.com
- 存在しない部署ID: 999

---

### 4.4 シナリオ4: 部署管理機能の確認

#### シナリオ概要
部署一覧取得と部署詳細取得が正しく動作することを確認します。

#### テスト目的
部署管理機能が正しく動作することを確認する。

#### 前提条件
- アプリケーションが起動している
- 部署データが登録されている

#### テスト手順

##### ステップ1: 部署一覧取得
1. 部署一覧取得APIを呼び出す
   - メソッド: GET
   - URL: `http://localhost:8080/api/v1/departments`

2. レスポンスを確認する
   - ステータスコード: 200 OK
   - Content-Type: application/json
   - レスポンスボディに部署一覧が含まれている
   - 各部署にid、name、codeが含まれている

**期待結果**
- 部署一覧が正常に取得できる
- 登録されている部署がすべて含まれている
- レスポンスが正しい形式で返却される

---

##### ステップ2: 部署詳細取得
1. 存在する部署IDで部署詳細取得APIを呼び出す
   - メソッド: GET
   - URL: `http://localhost:8080/api/v1/departments/1`

2. レスポンスを確認する
   - ステータスコード: 200 OK
   - Content-Type: application/json
   - レスポンスボディに部署情報が含まれている
   - id、name、codeが正しく返却される

**期待結果**
- 部署詳細が正常に取得できる
- 正しい部署情報が返却される

---

##### ステップ3: 存在しない部署IDで部署取得
1. 存在しない部署IDで部署詳細取得APIを呼び出す
   - メソッド: GET
   - URL: `http://localhost:8080/api/v1/departments/999`

2. レスポンスを確認する
   - ステータスコード: 404 Not Found
   - Content-Type: application/json
   - エラーレスポンスが返却される
   - errorCode: ERR004
   - message: "部署が見つかりません"
   - timestampが含まれている

**期待結果**
- 404エラーが返却される
- エラーレスポンスが正しい形式で返却される

---

#### テストデータ
- 部署ID: 1（営業部、SALES）
- 部署ID: 2（開発部、DEV）
- 存在しない部署ID: 999

---

### 4.3 シナリオ3: 社員検索機能の確認

#### シナリオ概要
社員検索機能（名前、部署での検索）が正しく動作することを確認します。

#### テスト目的
検索機能が正しく動作することを確認する。

#### 前提条件
- アプリケーションが起動している
- 複数の社員データが登録されている

#### テスト手順

##### 検索ケース1: 名前で検索
1. 名前で社員検索APIを呼び出す
   - メソッド: GET
   - URL: `http://localhost:8080/api/v1/employees?name=山田`

2. レスポンスを確認する
   - ステータスコード: 200 OK
   - Content-Type: application/json
   - 名前に"山田"が含まれる社員のみが返却される
   - 部分一致で検索できる

**期待結果**
- 検索条件に一致する社員が返却される
- 部分一致で検索できる

---

##### 検索ケース2: 部署IDで検索
1. 部署IDで社員検索APIを呼び出す
   - メソッド: GET
   - URL: `http://localhost:8080/api/v1/employees?departmentId=1`

2. レスポンスを確認する
   - ステータスコード: 200 OK
   - Content-Type: application/json
   - 指定した部署の社員のみが返却される
   - 他の部署の社員は含まれない

**期待結果**
- 指定した部署の社員が返却される
- 他の部署の社員は含まれない

---

##### 検索ケース3: 名前と部署IDの両方で検索
1. 名前と部署IDの両方で社員検索APIを呼び出す
   - メソッド: GET
   - URL: `http://localhost:8080/api/v1/employees?name=山田&departmentId=1`

2. レスポンスを確認する
   - ステータスコード: 200 OK
   - Content-Type: application/json
   - 両方の条件に一致する社員のみが返却される
   - AND条件で検索できる

**期待結果**
- 複数の検索条件が正しく適用される
- 条件に一致する社員が返却される

---

#### テストデータ
- 検索キーワード: "山田"
- 部署ID: 1

---

### 4.5 シナリオ5: ページネーションの確認

#### シナリオ概要
ページネーション機能が正しく動作することを確認します。

#### テスト目的
ページネーションが正しく動作することを確認する。

#### 前提条件
- アプリケーションが起動している
- 複数の社員データが登録されている（20件以上）

#### テスト手順

##### ページネーションケース1: 1ページ目を取得
1. 1ページ目を取得する
   - メソッド: GET
   - URL: `http://localhost:8080/api/v1/employees?page=0&size=10`

2. レスポンスを確認する
   - ステータスコード: 200 OK
   - Content-Type: application/json
   - 10件の社員が返却される
   - totalElements、totalPages、currentPageが正しい
   - ページネーション情報が正確

**期待結果**
- 1ページ目が正しく取得できる
- ページネーション情報が正しい

---

##### ページネーションケース2: 2ページ目を取得
1. 2ページ目を取得する
   - メソッド: GET
   - URL: `http://localhost:8080/api/v1/employees?page=1&size=10`

2. レスポンスを確認する
   - ステータスコード: 200 OK
   - Content-Type: application/json
   - 2ページ目の社員が返却される
   - 1ページ目とは異なる社員が返却される
   - ページネーション情報が正しい

**期待結果**
- 2ページ目が正しく取得できる
- 1ページ目とは異なる社員が返却される

---

#### テストデータ
- ページサイズ: 10
- ページ番号: 0（1ページ目）、1（2ページ目）

---

## 5. テスト実行手順

### 5.1 テスト環境の準備

1. アプリケーションを起動する
   ```bash
   mvn spring-boot:run
   ```

2. アプリケーションが正常に起動したことを確認する
   - ログにエラーが表示されていない
   - ポート8080でリッスンしている

3. 初期データを確認する
   - H2 Consoleにアクセス: `http://localhost:8080/h2-console`
   - 部署データが登録されていることを確認

### 5.2 テスト実行

1. 各テストシナリオを順番に実行する
2. テスト結果を記録する
3. スクリーンショットを取得する（必要に応じて）
4. 不具合が発見された場合は、バグレポートを作成する

### 5.3 テスト完了後

1. テスト結果をまとめる
2. テストレポートを作成する
3. 不具合があれば修正を依頼する

---

## 6. テスト結果記録

### 6.1 テスト結果表

| シナリオID | シナリオ名 | 実行日 | 実行者 | 結果 | 備考 |
|-----------|-----------|--------|--------|------|------|
| ST-001 | 社員作成から削除までの一連の流れ | | | | |
| ST-002 | エラーハンドリングの確認 | | | | |
| ST-003 | 社員検索機能の確認 | | | | |
| ST-004 | 部署管理機能の確認 | | | | |
| ST-005 | ページネーションの確認 | | | | |

### 6.2 結果記号
- ✅ 合格（Pass）
- ❌ 不合格（Fail）
- ⚠️ 保留（Pending）
- ⏭️ スキップ（Skip）

---

## 7. パフォーマンステスト（簡易）

### 7.1 レスポンス時間の確認

各APIのレスポンス時間を確認します。

| API | 期待値 | 実測値 | 結果 |
|-----|--------|--------|------|
| GET /api/v1/employees | < 500ms | | |
| GET /api/v1/employees/{id} | < 200ms | | |
| POST /api/v1/employees | < 300ms | | |
| PUT /api/v1/employees/{id} | < 300ms | | |
| DELETE /api/v1/employees/{id} | < 200ms | | |

---

## 8. 不具合管理

### 8.1 不具合発見時の対応

1. 不具合を再現する
2. 不具合の詳細を記録する
3. スクリーンショットを取得する
4. バグレポートを作成する
5. 開発チームに報告する

### 8.2 バグレポート項目

- バグID
- 発見日時
- 発見者
- シナリオID
- 不具合の概要
- 再現手順
- 期待結果
- 実際の結果
- スクリーンショット
- 優先度
- ステータス

---

## 9. 変更履歴

| バージョン | 変更日 | 変更内容 | 変更者 |
|-----------|--------|---------|--------|
| 1.0 | 2025-12-01 | 初版作成 | [作成者名] |

